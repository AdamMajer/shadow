#!/bin/sh

set -e

export LC_ALL=C
unset LANG
unset LANGUAGE

succeded=0
failed=0
failed_tests=""

run_test()
{
	if $1 > $1.log
	then
		succeded=$((succeded+1))
		echo -n "+"
	else
		failed=$((failed+1))
		failed_tests="$failed_tests $1"
		echo -n "-"
	fi
	cat $1.log >> testsuite.log
}

echo "+: test passed"
echo "-: test failed"

# Empty the complete log.
> testsuite.log

run_test ./su/01/su_root.test
run_test ./su/01/su_user.test
run_test ./su/02/env_FOO-options_--login
run_test ./su/02/env_FOO-options_--login_bash
run_test ./su/02/env_FOO-options_--preserve-environment
run_test ./su/02/env_FOO-options_--preserve-environment_bash
run_test ./su/02/env_FOO-options_-
run_test ./su/02/env_FOO-options_-_bash
run_test ./su/02/env_FOO-options_-l-m
run_test ./su/02/env_FOO-options_-l-m_bash
run_test ./su/02/env_FOO-options_-l
run_test ./su/02/env_FOO-options_-l_bash
run_test ./su/02/env_FOO-options_-m_bash
run_test ./su/02/env_FOO-options_-m
run_test ./su/02/env_FOO-options_-p
run_test ./su/02/env_FOO-options_-p_bash
run_test ./su/02/env_FOO-options__bash
run_test ./su/02/env_FOO-options_
run_test ./su/02/env_FOO-options_-p-
run_test ./su/02/env_FOO-options_-p-_bash
run_test ./su/02/env_special-options_-l-p
run_test ./su/02/env_special-options_-l
run_test ./su/02/env_special-options_-l-p_bash
run_test ./su/02/env_special-options_-l_bash
run_test ./su/02/env_special-options_-p
run_test ./su/02/env_special-options_-p_bash
run_test ./su/02/env_special-options_
run_test ./su/02/env_special-options__bash
run_test ./su/02/env_special_root-options_-l-p
run_test ./su/02/env_special_root-options_-l-p_bash
run_test ./su/02/env_special_root-options_-l
run_test ./su/02/env_special_root-options_-l_bash
run_test ./su/02/env_special_root-options_-p
run_test ./su/02/env_special_root-options_-p_bash
run_test ./su/02/env_special_root-options_
run_test ./su/02/env_special_root-options__bash
run_test ./su/03/su_run_command01.test
run_test ./su/03/su_run_command02.test
run_test ./su/03/su_run_command03.test
run_test ./su/03/su_run_command04.test
run_test ./su/03/su_run_command05.test
run_test ./su/03/su_run_command06.test
run_test ./su/03/su_run_command07.test
run_test ./su/03/su_run_command08.test
run_test ./su/03/su_run_command09.test
run_test ./su/03/su_run_command10.test
run_test ./su/03/su_run_command11.test
run_test ./su/03/su_run_command12.test
run_test ./su/03/su_run_command13.test
run_test ./su/03/su_run_command14.test
run_test ./su/03/su_run_command15.test
run_test ./su/03/su_run_command16.test
run_test ./su/03/su_run_command17.test
run_test ./su/04/su_wrong_user.test
run_test ./su/04/su_user_wrong_passwd.test
run_test ./su/04/su_user_wrong_passwd_syslog.test
run_test ./su/05/su_user_wrong_passwd_syslog.test
run_test ./su/06/su_user_syslog.test
run_test ./su/07/su_user_syslog.test
run_test ./su/08/env_special-options_
run_test ./su/08/env_special_root-options_
run_test ./su/09/env_special-options_
run_test ./su/09/env_special_root-options_
run_test ./convtools/01/run
run_test ./convtools/02_grpconv_remove_gshadow_only_entries/grpconv.test
run_test ./convtools/03_grpconv_copy_passwd/grpconv.test
run_test ./convtools/04_grpconv_no_password/grpconv.test
run_test ./convtools/05_grpconv_copy_passwd_existing_gshadow/grpconv.test
run_test ./convtools/06_grpconv_error_group_locked/grpconv.test
run_test ./convtools/07_grpconv_error_gshadow_locked/grpconv.test
run_test ./convtools/08_grpunconv_no_gshadow_file/grpunconv.test
run_test ./convtools/09_grpunconv_error_group_locked/grpunconv.test
run_test ./convtools/10_grpunconv_error_gshadow_locked/grpunconv.test
run_test ./chage/01/run
run_test ./chage/02/run
run_test ./chsh/01/run
run_test ./debian/01/run
run_test ./usertools/01/01_useradd_add_user.test
run_test ./usertools/01/01_userdel_delete_user.test
run_test ./usertools/01/02_useradd_recreate_deleted_user.test
run_test ./usertools/01/03_useradd_additional_options.test
run_test ./usertools/01/04_useradd_add_user_with_existing_UID_fail.test
run_test ./usertools/01/04_useradd_add_user_with_existing_UID_with_-o.test
run_test ./usertools/01/04_useradd_specified_UID.test
run_test ./usertools/01/04_useradd_specified_UID_and_GID.test
run_test ./usertools/01/04_userdel_delete_user_with_non_unique_UID.test
run_test ./usertools/01/05_useradd_invalid_numeric_primary_group.test
run_test ./usertools/01/06_useradd_invalid_named_primary_group.test
run_test ./usertools/01/07_useradd_numerical_primary_group.test
run_test ./usertools/01/08_useradd_named_primary_group.test
run_test ./usertools/01/09_usermod_change_user_info.test
run_test ./usertools/01/10_usermod_rename_user.test
run_test ./usertools/01/10_usermod_rename_user_in_group.test
run_test ./usertools/01/11_usermod_change_password.test
run_test ./usertools/01/11_usermod_lock_password.test
run_test ./usertools/01/11_usermod_unlock_empty_password.test
run_test ./usertools/01/11_usermod_unlock_password.test
run_test ./usertools/01/12_usermod_change_gid_name.test
run_test ./usertools/01/12_usermod_change_gid_number.test
run_test ./usertools/01/13_useradd_negative_UID.test
run_test ./usertools/01/14_useradd_out_of_range_UID.test
run_test ./usertools/01/15_useradd_specified_large_UID.test
run_test ./usertools/01/16_useradd_add_user_to_multiple_groups.test
run_test ./usertools/01/16_useradd_add_user_to_one_group.test
run_test ./usertools/01/17_useradd_create_homedir.test
run_test ./usertools/01/18_userdel_remove_homedir.test
run_test ./usertools/01/19_userdel_delete_user_in_group.test
run_test ./usertools/01/20_usermod_change_homedir.test
run_test ./usertools/01/21_usermod_change_and_move_homedir.test
run_test ./usertools/01/22_usermod_new_groups.test
run_test ./usertools/01/23_usermod_add_groups.test
run_test ./usertools/01/24_usermod_new_groups_remove_old_groups.test
run_test ./usertools/02/useradd_default_default_values.test
run_test ./usertools/02/useradd_get_default_values.test
run_test ./usertools/02/useradd_change_default_INACTIVE.test
run_test ./usertools/02/useradd_change_default_SHELL.test
run_test ./usertools/02/useradd_change_default_EXPIRE.test
run_test ./usertools/02/useradd_change_default_GROUP.test
run_test ./usertools/02/useradd_change_default_HOME.test
run_test ./usertools/02/useradd_change_defaults.test
run_test ./usertools/03/useradd_change_defaults.test
run_test ./usertools/04/01_useradd_add_user.test
run_test ./usertools/05_userdel_del_from_group_members/userdel.test
run_test ./usertools/06_userdel_del_from_gshadow_members/userdel.test
run_test ./usertools/07_userdel_del_from_gshadow_admins/userdel.test
run_test ./usertools/08_userdel_del_from_group_and_gshadow/userdel.test
run_test ./usertools/09_userdel_del_homedir/userdel.test
run_test ./usertools/10_userdel_del_homedir_wrong_owner/userdel.test
run_test ./usertools/11_usermod_move_homedir/usermod.test
run_test ./usertools/12_usermod_move_homedir_dev_null/usermod.test
run_test ./usertools/13_usermod_move_homedir_file/usermod.test
run_test ./usertools/14_usermod_move_homedir_other_device/usermod.test
run_test ./usertools/15_usermod_change_supplementary_groups/usermod.test
run_test ./usertools/16_usermod_remove_supplementary_groups/usermod.test
run_test ./usertools/17_usermod_change_supplementary_groups_numerical/usermod.test
run_test ./usertools/18_usermod_change_supplementary_groups-unknown_group/usermod.test
run_test ./usertools/19_usermod_change_supplementary_groups-unknown_numerical_group/usermod.test
run_test ./usertools/20_usermod_rename_user_in_member_lists/usermod.test
run_test ./usertools/21_usermod_rename_user_in_member_lists-and-add_supplementary_groups/usermod.test
run_test ./usertools/22_usermod-a_existing_supplementary_group/usermod.test
run_test ./usertools/23_usermod-a_existing_supplementary_group+rename/usermod.test
run_test ./usertools/24_usermod_locked_passwd/usermod.test
run_test ./usertools/25_usermod-G_locked_group/usermod.test
run_test ./cptools/01/run1
run_test ./cptools/01/run2
run_test ./cptools/01/run3
run_test ./cptools/01/run4
run_test ./cktools/01/run1
run_test ./cktools/01/run2
run_test ./crypt/login.defs_DES-MD5_CRYPT_ENAB/01_chpasswd.test
run_test ./crypt/login.defs_DES/01_chpasswd.test
run_test ./crypt/login.defs_DES/02_chpasswd--crypt-method-MD5.test
run_test ./crypt/login.defs_DES/03_chpasswd--crypt-method-DES.test
run_test ./crypt/login.defs_DES/04_chpasswd--crypt-method-NONE.test
run_test ./crypt/login.defs_DES/05_chpasswd-e.test
run_test ./crypt/login.defs_DES/06_chpasswd-m.test
run_test ./crypt/login.defs_DES/07_chgpasswd.test
run_test ./crypt/login.defs_DES/08_chgpasswd--crypt-method-MD5.test
run_test ./crypt/login.defs_DES/09_chgpasswd--crypt-method-DES.test
run_test ./crypt/login.defs_DES/10_chgpasswd--crypt-method-NONE.test
run_test ./crypt/login.defs_DES/11_chgpasswd-e.test
run_test ./crypt/login.defs_DES/12_chgpasswd-m.test
run_test ./crypt/login.defs_MD5/01_chpasswd.test
run_test ./crypt/login.defs_MD5_CRYPT_ENAB/01_chpasswd.test
run_test ./crypt/login.defs_SHA256/01_chpasswd.test
run_test ./crypt/login.defs_SHA512/01_chpasswd.test
run_test ./crypt/login.defs_none/01_chpasswd.test
run_test ./newusers/01_create_user/newusers.test
run_test ./newusers/02_update_password/newusers.test
run_test ./newusers/03_no_update_pid/newusers.test
run_test ./newusers/04_no_update_gid/newusers.test
run_test ./newusers/05_create_user_pid/newusers.test
run_test ./newusers/06_create_user_gid/newusers.test
run_test ./newusers/07_create_user_pid_gid/newusers.test
run_test ./newusers/08_create_user_pid_other-gid/newusers.test
run_test ./newusers/09_create_user_pid-as-user-bar/newusers.test
run_test ./newusers/10_create_user_gid-as-group-bar/newusers.test
run_test ./newusers/11_update_gecos/newusers.test
run_test ./newusers/12_update_shell/newusers.test
run_test ./newusers/13_create_user_new-home/newusers.test
run_test ./newusers/14_create_user_existing-home/newusers.test
run_test ./newusers/15_update_new-home/newusers.test
run_test ./newusers/16_update_existing-home/newusers.test
run_test ./newusers/17_create_user_pid-already-used/newusers.test
run_test ./newusers/18_create_user_gid-already-used/newusers.test
run_test ./newusers/19_update_keep-old-home/newusers.test
run_test ./newusers/20_multiple_users/newusers.test
run_test ./newusers/21_create_user_UID_MAX/newusers.test
run_test ./newusers/22_create_user_GID_MAX/newusers.test
run_test ./newusers/23_create_user_error_negativ_UID/newusers.test
run_test ./newusers/24_create_user_error_invalid_UID/newusers.test
run_test ./newusers/25_create_user_error_no_remaining_UID/newusers.test
run_test ./newusers/26_create_user_error_no_remaining_GID/newusers.test
run_test ./newusers/27_create_user_error_invalid_username/newusers.test
run_test ./newusers/28_create_user_error_invalid_groupname/newusers.test
run_test ./newusers/30_create_user_different_groupname/newusers.test
run_test ./newusers/31_create_user_error_invalid_GID/newusers.test
run_test ./newusers/32_create_user_error_gshadow_group_exists/newusers.test
run_test ./newusers/33_update_password_no_shadow_password/newusers.test
run_test ./newusers/34_update_password_no_shadow/newusers.test
run_test ./newusers/35_read_from_stdin/newusers.test
run_test ./newusers/36_create_user_encrypted/newusers.test
run_test ./newusers/37_create_user_encrypt_MD5/newusers.test
run_test ./newusers/38_update_password_no_shadow_encrypted/newusers.test
run_test ./newusers/39_update_password_no_shadow_password_encrypted/newusers.test
run_test ./newusers/40_update_password_encrypted/newusers.test

echo
echo "$succeded test(s) passed"
echo "$failed test(s) failed"
echo "log written in 'testsuite.log'"
if [ "$failed" != "0" ]
then
	echo "the following tests failed:"
	echo $failed_tests
fi

