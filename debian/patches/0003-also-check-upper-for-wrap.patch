From 801935d7e54d0cc169b37fe00cad1ce84e77048b Mon Sep 17 00:00:00 2001
From: Serge Hallyn <serge@hallyn.com>
Date: Fri, 5 Aug 2016 17:16:48 -0500
Subject: [PATCH 3/3] also check upper for wrap

---
 libmisc/idmapping.c | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

Index: shadow/libmisc/idmapping.c
===================================================================
--- shadow.orig/libmisc/idmapping.c
+++ shadow/libmisc/idmapping.c
@@ -89,7 +89,8 @@ struct map_range *get_map_ranges(int ran
 			free(mappings);
 			return NULL;
 		}
-		if (mapping->lower + mapping->count < mapping->lower) {
+		if (mapping->lower + mapping->count < mapping->lower ||
+				mapping->upper + mapping->count < mapping->upper) {
 			free(mapping);
 			return NULL;
 		}
